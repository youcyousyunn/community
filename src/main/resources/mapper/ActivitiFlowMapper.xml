<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ycs.community.activiti.dao.ActivitiFlowDao">
    <select id="qryFlowList" parameterType="java.util.Map" resultType="com.ycs.community.activiti.domain.po.FlowDef">
        SELECT
        t.id id,
        t.code code,
        t.name name,
        t.state state,
        t.create_time creTm
        FROM t_flow_def t
        <where>
            <if test="name != null">
                t.name = #{id}
            </if>
        </where>
    </select>

    <select id="qryFlowDefById" parameterType="java.lang.Long" resultType="com.ycs.community.activiti.domain.po.FlowDef">
        SELECT
        t.id id,
        t.code code,
        t.name name,
        t.state state,
        t.create_time creTm
        FROM t_flow_def t
        <where>
            <if test="_parameter != null">
                t.id = #{id}
            </if>
        </where>
    </select>

    <insert id="addFlowDef" parameterType="com.ycs.community.activiti.domain.po.FlowDef">
        INSERT INTO t_flow_main (code,
        `name`,
        `state`,
        create_time
        )
        values (
        #{code,jdbcType=VARCHAR},
        #{name,jdbcType=VARCHAR},
        #{state,jdbcType=INTEGER},
        #{creTm,jdbcType=BIGINT}
       )
    </insert>

    <select id="qryFlowMainByTaskId" parameterType="java.lang.String" resultType="com.ycs.community.activiti.domain.po.FlowMain">
        SELECT
        t.id id,
        t.task_id taskId,
        t.flow_id flowId,
        t.state state,
        t.create_time creTm,
        t.update_time updTm
        FROM t_flow_main t
        <where>
            <if test="_parameter != null">
                t.task_id = #{taskId}
            </if>
        </where>
    </select>

    <update id="updFlowMain" parameterType="com.ycs.community.activiti.domain.po.FlowMain">
        UPDATE t_flow_main
        <set>
            <if test="flowId != null">
                flow_id = #{flowId},
            </if>
            <if test="updTm != null">
                update_time = #{updTm}
            </if>
        </set>
        <where>
            <if test="id != null">
                id = #{id}
            </if>
        </where>
    </update>

    <insert id="addFlowMain" parameterType="com.ycs.community.activiti.domain.po.FlowMain" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO t_flow_main (task_id,
        flow_id,
        `state`,
        create_time
        )
        values (
        #{taskId,jdbcType=BIGINT},
        #{flowId,jdbcType=BIGINT},
        #{state,jdbcType=INTEGER},
        #{creTm,jdbcType=BIGINT}
       )
    </insert>
</mapper>